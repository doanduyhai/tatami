function fillUserTemplate(a,b){$newUserLine=$("#fullUserTemplate").clone().attr("id","");$newUserLine.find(".tweetGravatar").attr("data-user",a.login).attr("src","http://www.gravatar.com/avatar/"+a.gravatar+"?s=32").attr("data-modal-highlight","#userProfileModal").end().find(".userLink").attr("data-user",a.login).attr("title","Show "+a.login+" tweets").end().find("em").html("@"+a.login).end().find(".userDetailsName").html(a.firstName+" "+a.lastName).end().find(".badge").html(a.tweetCount).attr("data-user",a.login);if(b=="search"||b=="followers"){if(login!=a.login){if(a.follow){$newUserLine.find(".userAction a").attr("data-follow",a.login).attr("title","Follow "+a.login).attr("data-modal-hide",".modal").find("i").addClass("icon-eye-open")}else{$newUserLine.find(".userAction a").attr("data-unfollow",a.login).attr("title","Stop following "+a.login).attr("data-modal-hide",".modal").find("i").addClass("icon-eye-close")}}}else if(b=="friends"){if(login!=a.login){$newUserLine.find(".userAction a").attr("data-unfollow",a.login).attr("title","Stop following "+a.login).find("i").addClass("icon-eye-close")}}bindListeners($newUserLine);return $newUserLine}function registerFetchUserHandlers(){$(".userPagingButton").click(function(a){var b=$(a.target);var c=b.closest("footer").find(".pageSelector option").filter(":selected").val();var d=b.closest("div.tab-pane.active").attr("id");var e=b.closest("footer").closest("div").find(".userLineContent tr.data").last().find(".tweetGravatar").attr("data-user");refreshUserLine(d,e,parseInt(c),false);return false})}function registerUserSearchListener(){$("#userSearchForm button").click(function(){$("#searchErrorPanel").hide();$.ajax({type:HTTP_POST,url:"rest/usersSearch",contentType:"application/json;  charset=UTF-8",data:JSON.stringify({searchString:$.trim($("#followUserInput").val())}),dataType:JSON_DATA,success:function(a){var b=$("#userSearchList");b.empty();if(a.length>0){$.each(a,function(a,c){b.append(fillUserTemplate(c,"search"))})}else{$newUserLine=$("#emptyUserSearchTemplate").clone().attr("id","").appendTo(b)}$("#userSearchPanel").show()},error:errorHandler($("#searchErrorPanel"))});return false})}function registerRefreshUserLineListeners(){$(".refreshUserLineIcon").click(refreshCurrentUserLine)}function registerHomePanelListeners(){bindListeners($("#homePanel"))}function registerUserProfileModalListeners(){bindListeners($("#userProfileFooter"))}function buildUserFetchRange(a,b,c){return{startUser:a,count:b,functionalKey:c}}function refreshUserLine(a,b,c,d){var e=$("#"+a+" footer").attr("data-userFetch-url");var f=$("#"+a+" footer").attr("data-userFetch-type");var g=$("#"+a+" footer").attr("data-userFetch-key");var h=$("#"+a+" .userLineContent");var i=buildUserFetchRange(b,c,g);$.ajax({type:HTTP_POST,url:e,contentType:JSON_CONTENT,data:JSON.stringify(i),dataType:JSON_DATA,success:function(a){if(a.length>0){if(d){h.empty();$("#userPaddingTemplate tr").clone().appendTo(h);$("#userPaddingTemplate tr").clone().appendTo(h)}else{h.find("tr:last-child").remove()}$.each(a,function(a,b){h.append(fillUserTemplate(b,f))});$("#userPaddingTemplate tr").clone().appendTo(h).show()}else if(d){h.empty()}}})}function refreshCurrentUserLine(){var a=$("#contactsline div.tab-pane.active tbody tr.data").size();var b=$("#contactsline div.tab-pane.active.userLine").attr("id");if(b!=null){refreshUserLine(b,null,a,true)}return false}function refreshFollowersline(a){$("#contactsTab").tab("show");$("#followersLine footer").attr("data-userFetch-key",a);if(a!=login){$("#followersLine h2").html("Followers of "+a).addClass("red")}else{$("#followersLine h2").html("My followers").removeClass("red")}if($("#followersLine").hasClass("active")){refreshCurrentUserLine()}else{directContatTabClick=false;$("#followersTab").tab("show");directContatTabClick=true}}function refreshFriendsline(a){$("#contactsTab").tab("show");$("#friendsLine footer").attr("data-userFetch-key",a);if(a!=login){$("#friendsLine h2").html("Friends of "+a).addClass("red")}else{$("#friendsLine h2").html("My friends").removeClass("red")}if($("#friendsLine").hasClass("active")){refreshCurrentUserLine()}else{directContatTabClick=false;$("#friendsTab").tab("show");directContatTabClick=true}}function refreshHome(){$.ajax({type:HTTP_GET,url:"rest/usersProfile/"+login,dataType:JSON_DATA,success:function(a){$("#homePanel").find("#picture").attr("src","http://www.gravatar.com/avatar/"+a.gravatar+"?s=64").end().find("#firstName").html(a.firstName).end().find("#latName").html(a.lastName).end().find("#tweetCount").html(a.tweetCount).end().find("#friendsCount").html(a.friendsCount).end().find("#followersCount").html(a.followersCount).end()}})}function refreshUserSuggestions(){$.ajax({type:HTTP_GET,url:"rest/users/suggestions",dataType:JSON_DATA,success:function(a){var b=$("#userSuggestions");b.empty();if(a.length>0){$.each(a,function(a,c){b.append(fillUserTemplate(c))})}else{$newUserLine=$("#emptyUserTemplate").clone().attr("id","").appendTo(b)}}})}function loadEmptyUserLines(){$("#contactsPanel").load("fragments/mobile/contacts.html #contactsline",function(){$('#contactsPanel a[data-toggle="tab"]').on("shown",function(a){if(a.target.hash=="#friendsLine"){if(directContatTabClick){$("#friendsLine h2").html("My friends").removeClass("red");$("#friendsLine footer").attr("data-userFetch-key",login)}refreshCurrentUserLine()}else if(a.target.hash=="#followersLine"){if(directContatTabClick){$("#followersLine h2").html("My followers").removeClass("red");$("#followersLine footer").attr("data-userFetch-key",login)}refreshCurrentUserLine()}});registerRefreshUserLineListeners();registerFetchUserHandlers()})}function loadProfile(){$("#profilePanel").empty();$("#profilePanel").load("fragments/mobile/profile.html #profileContent",function(){$("#profilePanel").find('button[type="submit"]').click(updateProfile)})}function loadSuggestions(){$("#suggestionsPanel").empty();$("#suggestionsPanel").load("fragments/mobile/suggestions.html #suggestionsline",function(){refreshUserSuggestions();registerUserSearchListener()})}function updateUserProfileModal(a){var b=$(window).width();var c=$(window).height();console.log("currentWidth = "+b);console.log("currentHeight = "+c);$("#userProfileModal").find("#userProfileLogin").html("@"+a.login).end().find("#userProfileGravatar .tweetGravatar").attr("src","http://www.gravatar.com/avatar/"+a.gravatar+"?s=64").end().find("#userProfileName").html(a.firstName+" "+a.lastName).end().find("#userProfileLocation span:nth-child(2)").html(a.location).end().find("#userProfileWebsite a").html(a.website).attr("href",a.website).end().find("#userProfileBio").html(a.biography).end().find("#userProfileTweetsCount").attr("data-user",a.login).html(a.tweetCount).end().find("#userProfileFriendsCount").attr("data-friends",a.login).html(a.friendsCount).end().find("#userProfileFollowersCount").attr("data-followers",a.login).html(a.followersCount)}function showUserProfile(a){$.ajax({type:HTTP_GET,url:"rest/usersProfile/"+a,dataType:JSON_DATA,success:function(a){updateUserProfileModal(a);$("#userProfileModal").modal("show")}})}function updateUserCounters(){$.ajax({type:HTTP_GET,url:"rest/usersStats/"+login,dataType:JSON_DATA,success:function(a){$("#tweetCount").text(a.tweetCount);$("#friendsCount").text(a.friendsCount);$("#followersCount").text(a.followersCount)}})}function tweet(){$("#tweetErrorPanel").hide();$.ajax({type:HTTP_POST,url:"rest/tweets",async:false,contentType:"application/json;  charset=UTF-8",data:JSON.stringify({content:$.trim($("#tweetContent").val())}),dataType:JSON_DATA,success:function(a){setTimeout(function(){$("#tweetContent").slideUp().val("").slideDown("fast");updateUserCounters();refreshTimeline();refreshUserSuggestions()},300)},error:errorHandler($("#tweetErrorPanel"))});return false}function updateProfile(){$("#userProfileErrorPanel").hide();$.ajax({type:HTTP_POST,url:"rest/users/"+login,contentType:JSON_CONTENT,data:JSON.stringify($("#updateUserForm").serializeObject()),dataType:JSON_DATA,success:function(a){$("#defaultTab").tab("show");setTimeout(function(){refreshHome();updateUserCounters()},300)},error:errorHandler($("#userProfileErrorPanel"))});return false}function removeFriend(a){$("#followErrorPanel").hide();$.ajax({type:HTTP_POST,url:"rest/users/"+login+"/removeFriend",contentType:"application/json;  charset=UTF-8",data:a,dataType:JSON_DATA,success:function(a){setTimeout(function(){updateUserCounters();refreshUserSuggestions();refreshFriendsline(login)},300)},error:errorHandler($("#followErrorPanel"))})}function followUser(a){$("#followErrorPanel").hide();$.ajax({type:HTTP_POST,url:"rest/users/"+login+"/followUser",contentType:JSON_CONTENT,data:a,dataType:JSON_DATA,success:function(a){setTimeout(function(){$("#followUserInput").val("");updateUserCounters();refreshUserSuggestions();refreshFriendsline(login)},300)},error:errorHandler($("#followErrorPanel"))});return false}function fillTweetTemplate(a,b){$newTweetLine=$("#tweetTemplate").clone().attr("id","");$newTweetLine.find(".tweetGravatar").attr("data-user",a.login).attr("src","http://www.gravatar.com/avatar/"+a.gravatar+"?s=32");if(b!="userline"){if(login!=a.login){$newTweetLine.find("article strong").empty().html(a.firstName+" "+a.lastName+"  ").after('<a class="tweetAuthor" href="#" data-user="'+a.login+'" title="Show '+a.login+' tweets"><em>@'+a.login+"</em></a><br/>")}}else{$newTweetLine.find("article strong").empty().html(a.firstName+" "+a.lastName+"<br/>")}$newTweetLine.find("article span").html(a.content);if(b!="timeline"&&a.authorFollow){$newTweetLine.find(".tweetFriend").append('<a href="#" title="Follow" data-follow="'+a.login+'"><i class="frame icon-eye-open"></i></a>  ')}if(a.authorForget){$newTweetLine.find(".tweetFriend").append('<a href="#" title="Stop following" data-unfollow="'+a.login+'"><i class="frame icon-eye-close"></i></a>  ')}if(b!="favoriteline"&&a.addToFavorite){$newTweetLine.find(".tweetFriend").append('<a href="#" title="Like" data-like="'+a.tweetId+'"><i class="frame icon-star"></i></a>  ')}if(b=="favoriteline"&&!a.addToFavorite){$newTweetLine.find(".tweetFriend").append('<a href="#" title="Stop liking" data-unlike="'+a.tweetId+'"><i class="frame icon-star-empty"></i></a>  ')}$newTweetLine.find("article").attr("data-tweetId",a.tweetId);$newTweetLine.find(".tweetDate aside").empty().html(a.prettyPrintTweetDate);bindListeners($newTweetLine);return $newTweetLine.find("tr")}function registerFetchTweetHandlers(a){a.find(".tweetPagingButton").click(function(a){var b=$(a.target);var c=b.closest("footer").find(".pageSelector option").filter(":selected").val();var d=b.closest("div.tab-pane.active").attr("id");var e=b.closest("footer").closest("div").find(".lineContent tr.data").last().find("article").attr("data-tweetId");refreshLine(d,e,parseInt(c),false);return false})}function registerRefreshLineListeners(a){a.find(".refreshLineIcon").click(refreshCurrentLine)}function buildTweetFetchRange(a,b,c){return{startTweetId:a,count:b,functionalKey:c}}function refreshLine(a,b,c,d){var e=$("#"+a+" footer").attr("data-tweetFetch-url");var f=$("#"+a+" footer").attr("data-tweetFetch-type");var g=$("#"+a+" footer").attr("data-tweetFetch-key");var h=$("#"+a+" .lineContent");var i=buildTweetFetchRange(b,c,g);$.ajax({type:HTTP_POST,url:e,contentType:JSON_CONTENT,data:JSON.stringify(i),dataType:JSON_DATA,success:function(a){if(a.length>0){if(d){h.empty();$("#tweetPaddingTemplate tr").clone().appendTo(h);$("#tweetPaddingTemplate tr").clone().appendTo(h)}else{h.find("tr:last-child").remove()}$.each(a,function(a,b){h.append(fillTweetTemplate(b,f))});$("#tweetPaddingTemplate tr").clone().appendTo(h).show()}else if(d){h.empty()}}})}function refreshCurrentLine(){var a=$("#dataContentPanel div.tab-pane.active tbody tr.data").size();var b=$("#dataContentPanel div.tab-pane.active").attr("id");refreshLine(b,null,a,true);return false}function refreshTimeline(){$("#timelineTab").tab("show");refreshCurrentLine()}function loadTagsline(a){if(a!=null){$("#tagTweetsList").empty();$("#taglinePanel footer").attr("data-tweetFetch-key",a);$("#taglineTab").tab("show")}}function loadUserline(a){if(a!=null){$("#userTweetsList").empty();$("#userlinePanel footer").attr("data-tweetFetch-key",a);$("#userlineTab").tab("show")}}function loadEmptyLines(){$("#timelinePanel").load("fragments/mobile/timeline.html #timeline",function(){initTimeline();bindListeners($("#tweetsList"));registerRefreshLineListeners($("#timelinePanel"));registerFetchTweetHandlers($("#timelinePanel"))});$("#favlinePanel").load("fragments/mobile/favline.html #favline",function(){initFavoritesline();bindListeners($("#favTweetsList"));registerRefreshLineListeners($("#favlinePanel"));registerFetchTweetHandlers($("#favlinePanel"))});$("#userlinePanel").load("fragments/mobile/userline.html #userline",function(){registerRefreshLineListeners($("#userlinePanel"));registerFetchTweetHandlers($("#userlinePanel"))});$("#taglinePanel").load("fragments/mobile/tagline.html #tagline",function(){registerRefreshLineListeners($("#taglinePanel"));registerFetchTweetHandlers($("#taglinePanel"))})}function initFavoritesline(){refreshLine("favlinePanel",null,DEFAULT_TWEET_LIST_SIZE,true)}function initTimeline(){refreshLine("timelinePanel",null,DEFAULT_TWEET_LIST_SIZE,true)}function removeFavoriteTweet(a){$.ajax({type:HTTP_GET,url:"rest/unlikeTweet/"+a,dataType:JSON_DATA,success:function(){setTimeout(function(){$("#favoriteTab").tab("show");refreshCurrentLine()},300)}});return false}function addFavoriteTweet(a){$.ajax({type:HTTP_GET,url:"rest/likeTweet/"+a,dataType:JSON_DATA,success:function(){setTimeout(function(){$("#favoriteTab").tab("show");refreshCurrentLine()},300)}});return false}function errorHandler(a){return function(b,c,d){a.find(".errorMessage").empty().html(b.responseText).end().show()}}function bindListeners(a){a.find("a[data-follow]").click(function(a){var b=$(a.currentTarget).attr("data-follow");followUser(b);return false});a.find("a[data-unfollow]").click(function(a){var b=$(a.currentTarget).attr("data-unfollow");removeFriend(b);return false});a.find("a[data-like]").click(function(a){var b=$(a.currentTarget).attr("data-like");addFavoriteTweet(b);return false});a.find("a[data-unlike]").click(function(a){var b=$(a.currentTarget).attr("data-unlike");removeFavoriteTweet(b);return false});a.find("a[data-user],span[data-user]").click(function(a){var b=$(a.currentTarget).attr("data-user");loadUserline(b);return false});a.find("span[data-friends]").click(function(a){var b=$(a.currentTarget).attr("data-friends");refreshFriendsline(b);return false});a.find("span[data-followers]").click(function(a){var b=$(a.currentTarget).attr("data-followers");refreshFollowersline(b);return false});a.find("a[data-tag]").click(function(a){var b=$(a.currentTarget).attr("data-tag");loadTagsline(b);return false});a.find("[data-modal-hide]").click(function(a){var b=$(a.currentTarget).attr("data-modal-hide");if(b!=null){$(""+b).modal("hide")}});a.find("img.tweetGravatar[data-user],#picture").click(function(a){if($(a.currentTarget).data("popover")!=null){$(a.currentTarget).popover("hide")}var b=$(a.currentTarget).attr("data-modal-highlight");var c=$(a.currentTarget).attr("data-user");showUserProfile(c);if(b!=null){$(b).css("z-index",5e3)}return false})}$.fn.serializeObject=function(){var a={};var b=this.serializeArray();$.each(b,function(){if(a[this.name]!==undefined){if(!a[this.name].push){a[this.name]=[a[this.name]]}a[this.name].push($.trim(this.value)||"")}else{a[this.name]=$.trim(this.value)||""}});return a};var clickFromLink=false;var directContatTabClick=true;!function(a){loadProfile();loadSuggestions();a('a[data-toggle="tab"]').on("shown",function(a){if(a.target.hash=="#timelinePanel"||a.target.hash=="#userlinePanel"||a.target.hash=="#taglinePanel"){if(!clickFromLink){refreshCurrentLine()}}});a(function(){a.ajaxSetup({statusCode:{901:function(){window.location.replace("./login")}}});a("#tweetButton").click(tweet);loadEmptyLines();loadEmptyUserLines();a("#picture").click(function(){var b=a("#picture").attr("data-user");showUserProfile(b);return false});registerUserProfileModalListeners();registerHomePanelListeners()})}(window.jQuery);