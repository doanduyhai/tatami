<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">

	<bean id="authenticationService" class="fr.ippon.tatami.service.security.AuthenticationService">
		<property name="userRepository" ref="userRepository"/>
	</bean>
	

	
	<bean id="abstractlineService" class="fr.ippon.tatami.service.lines.AbstractlineService" abstract="true">
		<property name="favoriteLineRepository" ref="favoriteRepository"/>
		<property name="tweetRepository" ref="tweetRepository"/>
		<property name="userService" ref="userService"/>
	</bean>
	
	<bean id="timelineService" class="fr.ippon.tatami.service.lines.TimelineService" parent="abstractlineService">
		<property name="timeLineRepository" ref="timeLineRepository"/>
		<property name="friendRepository" ref="friendRepository"/>
		<property name="followedTweetIndexRepository" ref="followedTweetIndexRepository"/>
	</bean>	
	
	<bean id="favoritelineService" class="fr.ippon.tatami.service.lines.FavoritelineService" parent="abstractlineService">
		<property name="favoriteIndexRepository" ref="favoriteIndexRepository"/>
	</bean>
	
	<bean id="mentionlineService" class="fr.ippon.tatami.service.lines.MentionlineService" parent="abstractlineService">
		<property name="timeLineRepository" ref="timeLineRepository"/>
		<property name="contactsService" ref="contactsService"/>
	</bean>
	
	<bean id="statslineService" class="fr.ippon.tatami.service.lines.StatslineService" parent="abstractlineService">
		<property name="statsRepository" ref="statsRepository"/>
	</bean>	

	<bean id="taglineService" class="fr.ippon.tatami.service.lines.TaglineService" parent="abstractlineService">
		<property name="tagLineRepository" ref="tagLineRepository"/>
		<property name="hashtagDefault" value="${hashtag.default}"/>
	</bean>
	
	<bean id="userlineService" class="fr.ippon.tatami.service.lines.UserlineService" parent="abstractlineService">
		<property name="userLineRepository" ref="userLineRepository"/>
	</bean>	
	
	<bean id="tweetService" class="fr.ippon.tatami.service.tweet.TweetService">
		<property name="authenticationService" ref="authenticationService"/>
		<property name="tweetRepository" ref="tweetRepository"/>
	</bean>	

	<bean id="abstractUserService" class="fr.ippon.tatami.service.user.AbstractUserService" abstract="true">
		<property name="friendRepository" ref="friendRepository"/>
		<property name="userRepository" ref="userRepository"/>
	</bean>
	
	<bean id="userService" class="fr.ippon.tatami.service.user.UserService" parent="abstractUserService">
		<property name="authenticationService" ref="authenticationService"/>
		<property name="tweetRepository" ref="tweetRepository"/>
		<property name="userIndexRepository" ref="userIndexRepository"/>

	</bean>
		
	<bean id="contactsService" class="fr.ippon.tatami.service.user.ContactsService" parent="abstractUserService">
		<property name="followerRepository" ref="followerRepository"/>
		<property name="timeLineRepository" ref="timeLineRepository"/>
		<property name="followedTweetIndexRepository" ref="followedTweetIndexRepository"/>
		<property name="userService" ref="userService"/>
		<property name="statslineService" ref="statslineService"/>
	</bean>
	
	<bean id="urlShortenerService" class="fr.ippon.tatami.service.tweet.UrlShortenerService" />

	<bean id="xssEncodingService" class="fr.ippon.tatami.service.tweet.XssEncodingService" />
	
	<bean id="userPipelineManager" class="fr.ippon.tatami.service.pipeline.UserPipelineManager">
		<property name="userHandlers">
			<list>
				<ref bean="timelineService"/>
				<ref bean="contactsService"/>
			</list>
		</property>	
	</bean>
	
	<bean id="tweetPipelineManager" class="fr.ippon.tatami.service.pipeline.TweetPipelineManager" >
		<property name="tweetService" ref="tweetService"/>
		<property name="userService"  ref="userService"/>
		<property name="tweetHandlers">
			<list>
				<ref bean="xssEncodingService"/>
				<ref bean="urlShortenerService"/>
				<ref bean="tweetService"/>
				<ref bean="userlineService"/>
				<ref bean="timelineService"/>
				<ref bean="taglineService"/>
				<ref bean="mentionlineService"/>
				<ref bean="statslineService"/>
				<ref bean="favoritelineService"/>
				<ref bean="contactsService"/>
			</list>
		</property>
	</bean>
	
	<bean id="favoritePipelineManager" class="fr.ippon.tatami.service.pipeline.FavoritePipelineManager">
		<property name="tweetService" ref="tweetService"/>
		<property name="favoriteHandlers">
			<list>
				<ref bean="favoritelineService"/>
				<ref bean="timelineService"/>
			</list>
		</property>	
	</bean>							
</beans>
